<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Demo GUI - Books & Orders</title>
    <style>
        body {font-family: Arial, sans-serif; margin: 20px;}
        h2 {margin-top: 40px;}
        table {border-collapse: collapse; width: 100%; margin-top: 10px;}
        th, td {border: 1px solid #ccc; padding: 8px; text-align: left;}
        th {background: #f4f4f4;}
        button {margin: 2px;}
        .form-section {border: 1px solid #ddd; padding: 10px; margin-top: 10px;}
        .form-section input, .form-section textarea {width: 100%; margin: 4px 0;}
        .hidden {display: none;}
    </style>
</head>
<body>

<h1>Demo GUI - Books & Orders</h1>

<!-- --------------------------------------------------- -->
<!--  BOOKS SECTION -->
<!-- --------------------------------------------------- -->
<h2>Books (Buch)</h2>

<div class="form-section" id="bookForm">
    <h3 id="bookFormTitle">Create new book</h3>
    <input type="hidden" id="bookId">
    <label>Title: <input type="text" id="bookTitel"></label><br>
    <label>Author: <input type="text" id="bookAutor"></label><br>
    <label>ISBN: <input type="text" id="bookIsbn"></label><br>
    <label>Ausgeliehen (borrowed): <input type="checkbox" id="bookAusgeliehen"></label><br>
    <label>Ausgeliehen von (user‑id, optional): <input type="number" id="bookAusgeliehenVon"></label><br>
    <button onclick="saveBook()">Save</button>
    <button onclick="resetBookForm()">Cancel</button>
</div>

<table id="booksTable">
    <thead>
        <tr>
            <th>ID</th><th>Title</th><th>Author</th><th>ISBN</th>
            <th>Borrowed?</th><th>Borrowed‑by</th><th>Actions</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<hr>

<!-- --------------------------------------------------- -->
<!--  ORDERS SECTION -->
<!-- --------------------------------------------------- -->
<h2>Orders (Bestellung)</h2>

<div class="form-section" id="orderForm">
    <h3 id="orderFormTitle">Create new order</h3>
    <input type="hidden" id="orderId">
    <label>Produkt‑ID: <input type="number" id="orderProduktId"></label><br>
    <label>Menge (quantity): <input type="number" id="orderMenge"></label><br>
    <label>Preis (decimal): <input type="number" step="0.01" id="orderPreis"></label><br>
    <label>Beschreibung: <textarea id="orderBeschreibung"></textarea></label><br>
    <button onclick="saveOrder()">Save</button>
    <button onclick="resetOrderForm()">Cancel</button>
</div>

<table id="ordersTable">
    <thead>
        <tr>
            <th>ID</th><th>Produkt‑ID</th><th>Menge</th><th>Preis</th><th>Beschreibung</th><th>Actions</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
/* -------------------------------------------------
   Helper – generic fetch wrapper
   ------------------------------------------------- */
async function api(path, method = 'GET', body = null) {
    const opts = {method, headers: {'Content-Type': 'application/json'}};
    if (body) opts.body = JSON.stringify(body);
    const resp = await fetch(path, opts);
    if (!resp.ok) {
        const txt = await resp.text();
        throw new Error(`HTTP ${resp.status}: ${txt}`);
    }
    // DELETE returns empty body – avoid JSON parse error
    if (resp.status === 204) return null;
    return resp.json();
}

/* -------------------------------------------------
   BOOKS CRUD
   ------------------------------------------------- */
const booksTableBody = document.querySelector('#booksTable tbody');

async function loadBooks() {
    const books = await api('/api/buecher');
    booksTableBody.innerHTML = '';
    books.forEach(b => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${b.id}</td>
            <td>${b.titel}</td>
            <td>${b.autor}</td>
            <td>${b.isbn}</td>
            <td>${b.ausgeliehen}</td>
            <td>${b.ausgeliehenVon ?? ''}</td>
            <td>
                <button onclick="editBook(${b.id})">Edit</button>
                <button onclick="deleteBook(${b.id})">Delete</button>
            </td>`;
        booksTableBody.appendChild(tr);
    });
}

function resetBookForm() {
    document.getElementById('bookFormTitle').innerText = 'Create new book';
    document.getElementById('bookId').value = '';
    document.getElementById('bookTitel').value = '';
    document.getElementById('bookAutor').value = '';
    document.getElementById('bookIsbn').value = '';
    document.getElementById('bookAusgeliehen').checked = false;
    document.getElementById('bookAusgeliehenVon').value = '';
}

async function saveBook() {
    const id = document.getElementById('bookId').value;
    const payload = {
        titel: document.getElementById('bookTitel').value,
        autor: document.getElementById('bookAutor').value,
        isbn: document.getElementById('bookIsbn').value,
        ausgeliehen: document.getElementById('bookAusgeliehen').checked,
        ausgeliehenVon: document.getElementById('bookAusgeliehenVon').value
            ? Number(document.getElementById('bookAusgeliehenVon').value)
            : null
    };
    try {
        if (id) {
            // UPDATE
            await api(`/api/buecher/${id}`, 'PUT', payload);
        } else {
            // CREATE
            await api('/api/buecher', 'POST', payload);
        }
        resetBookForm();
        await loadBooks();
    } catch (e) { alert('Error: ' + e.message); }
}

async function editBook(id) {
    const book = await api(`/api/buecher/${id}`);
    document.getElementById('bookFormTitle').innerText = `Edit book #${id}`;
    document.getElementById('bookId').value = book.id;
    document.getElementById('bookTitel').value = book.titel;
    document.getElementById('bookAutor').value = book.autor;
    document.getElementById('bookIsbn').value = book.isbn;
    document.getElementById('bookAusgeliehen').checked = book.ausgeliehen;
    document.getElementById('bookAusgeliehenVon').value = book.ausgeliehenVon ?? '';
}

async function deleteBook(id) {
    if (!confirm(`Delete book #${id}?`)) return;
    try {
        await api(`/api/buecher/${id}`, 'DELETE');
        await loadBooks();
    } catch (e) { alert('Error: ' + e.message); }
}

/* -------------------------------------------------
   ORDERS CRUD
   ------------------------------------------------- */
const ordersTableBody = document.querySelector('#ordersTable tbody');

async function loadOrders() {
    const orders = await api('/api/bestellungen');
    ordersTableBody.innerHTML = '';
    orders.forEach(o => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${o.id}</td>
            <td>${o.produktId}</td>
            <td>${o.menge}</td>
            <td>${o.preis}</td>
            <td>${o.beschreibung}</td>
            <td>
                <button onclick="editOrder(${o.id})">Edit</button>
                <button onclick="deleteOrder(${o.id})">Delete</button>
            </td>`;
        ordersTableBody.appendChild(tr);
    });
}

function resetOrderForm() {
    document.getElementById('orderFormTitle').innerText = 'Create new order';
    document.getElementById('orderId').value = '';
    document.getElementById('orderProduktId').value = '';
    document.getElementById('orderMenge').value = '';
    document.getElementById('orderPreis').value = '';
    document.getElementById('orderBeschreibung').value = '';
}

async function saveOrder() {
    const id = document.getElementById('orderId').value;
    const payload = {
        produktId: Number(document.getElementById('orderProduktId').value),
        menge: Number(document.getElementById('orderMenge').value),
        preis: Number(document.getElementById('orderPreis').value),
        beschreibung: document.getElementById('orderBeschreibung').value
    };
    try {
        if (id) {
            await api(`/api/bestellungen/${id}`, 'PUT', payload);
        } else {
            await api('/api/bestellungen', 'POST', payload);
        }
        resetOrderForm();
        await loadOrders();
    } catch (e) { alert('Error: ' + e.message); }
}

async function editOrder(id) {
    const order = await api(`/api/bestellungen/${id}`);
    document.getElementById('orderFormTitle').innerText = `Edit order #${id}`;
    document.getElementById('orderId').value = order.id;
    document.getElementById('orderProduktId').value = order.produktId;
    document.getElementById('orderMenge').value = order.menge;
    document.getElementById('orderPreis').value = order.preis;
    document.getElementById('orderBeschreibung').value = order.beschreibung;
}

async function deleteOrder(id) {
    if (!confirm(`Delete order #${id}?`)) return;
    try {
        await api(`/api/bestellungen/${id}`, 'DELETE');
        await loadOrders();
    } catch (e) { alert('Error: ' + e.message); }
}

/* -------------------------------------------------
   Initial load
   ------------------------------------------------- */
document.addEventListener('DOMContentLoaded', () => {
    loadBooks();
    loadOrders();
});
</script>

</body>
</html>
